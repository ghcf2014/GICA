<extend name="Public/base" />

<block name="body">       
	<script type="text/javascript" src="/Public/static/uploadify/jquery.uploadify.min.js"></script>
	<div class="main-title cf">
		<h2>插件配置 [ 图片轮播 ]</h2>
	</div>
	<form action="/admin.php?s=/Addons/saveConfig.html" class="form-horizontal" method="post">
		<div class="form-item cf">
					<label class="item-label">
						轮播间隔时间（单位 毫秒）:											</label>
						<div class="controls">
								<input name="config[second]" class="text input-large" value="3000" type="text">
							</div>
					</div><div class="form-item cf">
					<label class="item-label">
						图片滚动方向:											</label>
						<div class="controls">
								<label class="radio">
										<input name="config[direction]" value="horizontal" checked="" type="radio">横向滚动									</label><label class="radio">
										<input name="config[direction]" value="vertical" type="radio">纵向滚动									</label>							</div>
					</div><div class="form-item cf">
					<label class="item-label">
						容器宽度（单位　像素）											</label>
						<div class="controls">
								<input name="config[imgWidth]" class="text input-large" value="400" type="text">
							</div>
					</div><div class="form-item cf">
					<label class="item-label">
						容器高度（单位　像素）											</label>
						<div class="controls">
								<input name="config[imgHeight]" class="text input-large" value="300" type="text">
							</div>
					</div><div class="form-item cf">
					<label class="item-label">
						图片链接（一行对应一个图片）											</label>
						<div class="controls">
								<label class="textarea input-large">
									<textarea name="config[url]"></textarea>
								</label>
							</div>
					</div><div class="form-item cf">
					<label class="item-label">
						轮播图片（双击可移除）											</label>
						<div class="controls">
								<input id="upload_picture_images" type="file">
								<input name="config[images]" id="cover_id_images" value="" type="hidden">
								<div class="upload-img-box">
																	</div>
								</div>
								<script type="text/javascript">
									//上传图片
									/* 初始化上传插件 */
									$("#upload_picture_images").uploadify({
										"height"          : 30,
										"swf"             : "/Public/static/uploadify/uploadify.swf",
										"fileObjName"     : "download",
										"buttonText"      : "上传图片",
										"uploader"        : "/admin.php?s=/File/uploadPicture/session_id/c228413jp26rs643ippom67ug0.html",
										"width"           : 120,
										'removeTimeout'   : 1,
										'fileTypeExts'    : '*.jpg; *.png; *.gif;',
										"onUploadSuccess" : uploadPictureimages,
										'onFallback' : function() {
								            alert('未检测到兼容版本的Flash.');
								        }
									});

									function uploadPictureimages(file, data){
										var data = $.parseJSON(data);
										var src = '';
										if(data.status){
											src = data.url || '' + data.path
											$("#cover_id_images").parent().find('.upload-img-box').append(
												'<div class="upload-pre-item" val="' + data.id + '"><img src="' + src + '" ondblclick="removePictureimages(this)"/></div>'
											);
											setPictureIdsimages();
										} else {
											updateAlert(data.info);
											setTimeout(function(){
												$('#top-alert').find('button').click();
												$(that).removeClass('disabled').prop('disabled',false);
											},1500);
										}
									}
									function removePictureimages(o){
										var p = $(o).parent().parent();
										$(o).parent().remove();
										setPictureIdsimages();
									}
									function setPictureIdsimages(){
										var ids = [];
										$("#cover_id_images").parent().find('.upload-img-box').find('.upload-pre-item').each(function(){
											ids.push($(this).attr('val'));
										});
										if(ids.length > 0)
											$("#cover_id_images").val(ids.join(','));
										else
											$("#cover_id_images").val('');
									}
								</script>
					</div>				<input name="id" value="32" readonly="" type="hidden">
		<button type="submit" class="btn submit-btn ajax-post" target-form="form-horizontal">确 定</button>
		<button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
	</form>
</block>

<block name="script">
	<script src="__STATIC__/thinkbox/jquery.thinkbox.js"></script>

	<script type="text/javascript">
	//搜索功能
	$("#search").click(function(){
		var url = $(this).attr('url');
        var query  = $('.search-form').find('input').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
        query = query.replace(/^&/g,'');
        if( url.indexOf('?')>0 ){
            url += '&' + query;
        }else{
            url += '?' + query;
        }
		window.location.href = url;
	});
	//回车搜索
	$(".search-input").keyup(function(e){
		if(e.keyCode === 13){
			$("#search").click();
			return false;
		}
	});
    //导航高亮
    highlight_subnav('{:U('User/index')}');
	</script>
</block>
